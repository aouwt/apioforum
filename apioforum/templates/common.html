{% macro disp_user(username) -%} 
<a href="{{url_for('user.view_user',username=username)}}" class="username">{{username}}</a>
{%- endmacro %}

{% macro post_url(post) -%}
	{{url_for('thread.view_thread', thread_id=post.thread)}}#post_{{post.id}}
{%- endmacro %}

{% macro disp_post(post, buttons=False, forum=None) %}
<div class="post {% if post.deleted %}deleted-post{% endif %}" id="post_{{post.id}}">
    <div class="post-heading">
        <span class="post-heading-a">
			{% if not post.deleted %}
				{{disp_user(post.author)}}
			{% else %}
				<span class="username">big brother</span>
			{% endif %}

			{% if forum != None %}
				{% set role = get_user_role(forum, post.author) %}
				{% if post.deleted %}
					<span class="user-role">
						(bureaucrat)
					</span>
				{% elif role != "other" %}
					<span class="user-role">
						({{ role }})
					</span>
				{% endif %}
			{% endif %}

			{{ts(post.created)}}

            {% if post.edited %}
                (edited {{ts(post.updated)}})
            {% endif %}
        </span>
        <span class="post-heading-b">
        {% if buttons and not post.deleted %}
			{% if post.author == g.user %}
				<a class="actionbutton"
				   href="{{url_for('thread.edit_post',post_id=post.id)}}">edit</a>
			{% endif %}
			{% if post.author == g.user or (forum and has_permission(forum, g.user, "p_delete_posts")) %}
				<a class="actionbutton"
				   href="{{url_for('thread.delete_post',post_id=post.id)}}">delete</a>
			{% endif %}
        {% endif %}
		<a class="post-anchor-link" href="{{post_url(post)}}">#{{post.id}}</a>
        </span>
    </div>
    <div class="post-content">
		{% if not post.deleted %}
			{{ post.content|md|safe }}
		{% else %}
			this post never existed.
		{% endif %}
    </div>
</div>
{% endmacro %}

{% macro ts(dt) -%}
<time title="{{dt.isoformat(' ')}}" datetime="{{dt.isoformat(' ')}}">{{dt | fuzzy}}</time>
{%- endmacro %}

{% macro tag(the_tag) -%}
<span class="tag" style="color: {{the_tag.text_colour}}; background-color: {{the_tag.bg_colour}}">{{the_tag.name}}</span>
{%- endmacro %}

{% macro ab(name,href) -%}
<a class="actionbutton" href="{{href}}">{{name}}</a>
{%- endmacro %}

{% macro breadcrumb() %}
<nav aria-label="Breadcrumb">
<ol class="breadcrumbs">
	{{- caller() -}}
</ol>
</nav>
{% endmacro %}

{% macro forum_bc_entries(forum_id) -%}
	{%- for f in forum_path(forum_id) -%}
		<li><a href="{{url_for('forum.view_forum',forum_id=f.id)}}">{{ f.name }}</a></li>
	{%- endfor %}
{%- endmacro %}

{% macro forum_breadcrumb(forum) %}
	{%- call breadcrumb() %}
		{{ forum_bc_entries(forum.id) }}
	{% endcall -%}
{% endmacro %}

{% macro thread_breadcrumb(thread) %}
	{%- call breadcrumb() %}
		{{ forum_bc_entries(thread.forum) }}
		<li>{{ thread.title }}</li>
	{% endcall -%}
{% endmacro %}
